CROSS = aarch64-suse-linux

SRC_C = $(wildcard *.c)
SRC_S = $(wildcard *.s)
OBJS = $(SRC_C:.c=.o) $(SRC_S:.s=.o) 

CFLAGS = -mcpu=cortex-a57

all: core.bin

%.o: %.c:
	$(CROSS)-gcc $(CFLAGS) -c $< -o $@ 

%.o: %.s:
	$(CROSS)-as $(CFLAGS) -c $< -o $@ -ggdb


core.bin: $(OBJS)
	(CROSS)-ld -T linker.lt $(OBJS) -o core.bin


qemu:
	qemu-system-aarch64 -S -machine virt -cpu cortex-a57 -nographic \
		-chardev tty,path=/dev/ttyUSB0,id=hostusbserial \
		-device pci-serial,chardev=hostusbserial \
		-kernel core.bin

clean:
	rm -r *.o *.bin