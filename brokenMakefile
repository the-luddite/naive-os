CROSS=arm-none-eabi
SRC=test uart

all: $(asm) $(bin)
	
asm: startup
	$(CROSS)-as -mcpu=arm926ej-s -g src/$<.s -o obj/$<.o

bin: $(SRC)
	$(CROSS)-gcc -c -mcpu=arm926ej-s -g src/$<.c -o obj/$<.o
	pushd obj && $(CROSS)-ld -T ../src/test.ld startup.o $^ -o ../bin/test.elf && popd
	$(CROSS)-objcopy -O binary bin/test.elf bin/test.bin

qemu:
	qemu-system-arm -M versatilepb -m 128M -nographic -kernel bin/test.bin

.PHONY: clean
clean:
	rm -r obj/* bin/*